{% extends '_base.html' %}
{% load static %}

{% block customstyle %}
<link rel="stylesheet" href="{% static 'css/checkout.css' %}">
{% endblock customstyle %}

{% block title %}Register{% endblock %}

{% block content %}
<!--================Login Box Area =================-->
<section class="login_box_area section_gap">
    <div class="container">
        <div class="row">
            <div class="col-lg-6">
                <div class="login_box_img">
                    <img class="img-fluid" src="{% static 'img/blog/blog-7.jpg' %}" alt="">
                    <div class="hover">
                        <h4>Welcome back!</h4>
                        <p>Log in to explore products, manage orders, and enjoy personalized shopping. Join us for a
                            seamless experience with exclusive offers. Your favorites await!</p>
                        <a class="btn custom-background" href="{% url 'app:login_page' %}">Log In</a>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="login_form_inner">
                    <h3>Create Account</h3>
                    <form class="row login_form" method="post" id="registration-form">
                        {% csrf_token %}
                        <div id="registration-errors" class="col-md-12 form-group text-danger"></div>
                        <div class="col-md-12 form-group">
                            <input type="text" class="form-control" id="firstName" name="firstName"
                                placeholder="First Name" onfocus="this.placeholder = ''"
                                onblur="this.placeholder = 'First Name'" required>
                        </div>
                        <div class="col-md-12 form-group">
                            <input type="text" class="form-control" id="lastName" name="lastName"
                                placeholder="Last Name" onfocus="this.placeholder = ''"
                                onblur="this.placeholder = 'Last Name'" required>
                        </div>
                        <div class="col-md-12 form-group">
                            <input type="email" class="form-control" id="email" name="email" placeholder="Email Address"
                                onfocus="this.placeholder = ''" onblur="this.placeholder = 'Email Address'" required>
                        </div>
                        <div class="col-md-12 form-group">
                            <input type="password" class="form-control" id="password" name="password"
                                placeholder="Password" onfocus="this.placeholder = ''"
                                onblur="this.placeholder = 'Password'" required>
                        </div>
                        <div class="col-md-12 form-group">
                            <input type="password" class="form-control" id="cmfpassword" name="cmfpassword"
                                placeholder="Confirm Password" onfocus="this.placeholder = ''"
                                onblur="this.placeholder = 'Confirm Password'" required>
                        </div>
                        <div class="col-md-12 form-group">
                            <button type="submit" value="submit" class="btn custom-outline-background w-75"
                                id="registerBtn">Register</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
<!--================End Login Box Area =================-->
{% endblock %}

{% block javascript %}
<script>
    $(document).ready(function () {
        $('#registration-form').on("submit", function (event) {
            event.preventDefault(); // Prevent default form submission

            $("#registerBtn").text("")
            $("#registerBtn").append("<i class='fa fa-spinner fa-spin'></i>")

            var formData = $(this).serialize();
            var url = "{% url 'app:handleUserRegistration' %}";

            // AJAX request
            $.ajax({
                type: 'POST',
                url: url,
                data: formData,
                dataType: 'json', // Expect JSON response
                success: function (response) {
                    if (response.success) {
                        location.href = "{% url 'app:home_page' %}"
                    } else {
                        // Display error message(s)
                        $('#registration-errors').text(response.message);
                        $("#registerBtn").text("Register")
                        $("#registerBtn").children().remove();
                    }
                },
                error: function () {
                    // Handle AJAX request error
                    $('#registration-errors').text('An error occurred. Please try again.');
                    $("#registerBtn").text("Register")
                    $("#registerBtn").children().remove();
                }
            });
        });
    });
</script>
{% endblock javascript %}